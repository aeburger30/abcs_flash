<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ABCs in a Flash!</title>
    <style>
        /* --- THEME COLORS --- */
        :root {
            --primary: #d32f2f; 
            --secondary: #00a896; 
            --accent: #FFD500; 
            --bg-color: #E0F7FA; 
            --card-bg: #ffffff;
            --text-color: #2c3e50;
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', 'Comic Sans MS', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.4) 0%, rgba(0, 168, 150, 0.1) 100%);
            margin: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden; 
            user-select: none;
        }

        /* --- SPLASH SCREEN --- */
        #splashScreen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 500;
            transition: transform 0.4s ease-in-out;
            padding: 20px;
        }

        #splashScreen.slide-up { transform: translateY(-100%); }

        #heroImage {
            width: auto; max-width: 95%; max-height: 55vh; 
            object-fit: contain; border-radius: 20px; margin-bottom: 30px;
            filter: drop-shadow(0 10px 20px rgba(0, 168, 150, 0.3));
            animation: float 6s ease-in-out infinite;
        }

        .splash-buttons { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; width: 100%; }

        .super-btn {
            padding: 15px 25px; font-size: 20px; font-weight: 900; color: white;
            border: none; border-radius: 50px; cursor: pointer; text-transform: uppercase;
            letter-spacing: 1px; transition: transform 0.2s; min-width: 160px;
        }

        .btn-start { background: linear-gradient(45deg, var(--secondary), #00E5FF); box-shadow: 0 6px 0 #00796b; }
        .btn-stats { background: linear-gradient(45deg, var(--primary), #ff5722); box-shadow: 0 6px 0 #c62828; }
        .super-btn:active { transform: translateY(6px); box-shadow: none; }

        /* --- GAME SCREEN --- */
        #gameContent {
            display: none; flex-direction: column; align-items: center;
            width: 100%; height: 100%; max-width: 600px;
            position: relative; justify-content: center;
        }

        /* Top Buttons */
        .icon-btn {
            position: absolute; top: 20px;
            background: white; border: 2px solid var(--secondary);
            border-radius: 50%; width: 50px; height: 50px;
            font-size: 24px; cursor: pointer; color: var(--secondary);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 10;
            transition: all 0.2s;
        }
        
        .home-btn { left: 20px; }
        .mute-btn { right: 20px; }

        .muted { opacity: 0.6; background: #eee; border-color: #ccc; color: #888; }

        h1 {
            font-size: 24px; margin: 0 0 15px 0;
            background: linear-gradient(to right, var(--secondary), var(--accent), var(--primary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-weight: 900; text-align: center;
        }

        .controls {
            background: rgba(255,255,255,0.9); backdrop-filter: blur(5px);
            padding: 10px; border-radius: 15px; display: flex;
            gap: 10px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            flex-wrap: wrap; justify-content: center; border: 2px solid var(--secondary);
        }
        
        select {
            padding: 8px; border-radius: 8px; border: 2px solid #ddd;
            font-size: 14px; color: var(--text-color); font-weight: bold; background: white;
        }

        .card-container { perspective: 1000px; margin-bottom: 20px; width: 100%; display: flex; justify-content: center; }

        .card {
            background-color: var(--card-bg); width: 260px; height: 340px; max-height: 50vh;
            border-radius: 30px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15), 0 5px 0 rgba(0,0,0,0.05);
            font-size: 160px; font-weight: 900; color: #333;
            border: 8px solid var(--secondary); position: relative;
            animation: float 4s ease-in-out infinite; 
        }

        .actions { display: flex; gap: 30px; z-index: 100; }

        .round-btn {
            width: 70px; height: 70px; border-radius: 50%; border: none;
            cursor: pointer; font-size: 35px; display: flex;
            align-items: center; justify-content: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .btn-wrong { background: white; color: var(--primary); border: 4px solid var(--primary); }
        .btn-correct { background: var(--secondary); color: white; border: 4px solid white; }
        .round-btn:active { transform: scale(0.9); }

        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-8px); } 100% { transform: translateY(0px); } }
        .pop { animation: pop 0.4s; }
        .shake { animation: shake 0.5s; }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-15px) rotate(-5deg); } 75% { transform: translateX(15px) rotate(5deg); } }
        @keyframes fall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        
        .confetti {
            position: absolute; font-size: 24px; animation: fall 1.5s linear forwards;
            pointer-events: none; z-index: 200;
        }

        /* Modal */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95); justify-content: center;
            align-items: center; z-index: 600; backdrop-filter: blur(5px);
        }
        .modal {
            background: white; width: 90%; max-width: 450px; border-radius: 25px;
            padding: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            border: 4px solid var(--secondary); max-height: 80vh;
            display: flex; flex-direction: column;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #888; font-size: 12px; text-transform: uppercase; padding-bottom: 10px;}
        td { padding: 12px 5px; border-bottom: 1px solid #eee; font-weight: bold;}
    </style>
</head>
<body>

    <div id="splashScreen">
        <img id="heroImage" src="flash-ABC.png" alt="ABC Superhero" onerror="this.style.display='none';">
        <div class="splash-buttons">
            <button class="super-btn btn-start" onclick="startGame()">Start Game ‚ñ∂</button>
            <button class="super-btn btn-stats" onclick="openReport()">My Stats üìä</button>
        </div>
    </div>

    <div id="gameContent">
        <button class="icon-btn home-btn" onclick="goBack()" title="Main Menu">üè†</button>
        <button class="icon-btn mute-btn" onclick="toggleMute()" id="muteBtn" title="Mute">üîä</button>

        <h1>ABCs in a Flash!</h1>
        <div class="controls">
            <select id="letterSet" onchange="changeSet()">
                <option value="all">All Letters (A-Z)</option>
                <optgroup label="Groups">
                    <option value="set1">A - E</option>
                    <option value="set2">F - J</option>
                    <option value="set3">K - O</option>
                    <option value="set4">P - T</option>
                    <option value="set5">U - Z</option>
                </optgroup>
                <optgroup label="Shapes">
                    <option value="straight">Straight Lines</option>
                    <option value="curves">Curvy Lines</option>
                    <option value="diagonal">Diagonals</option>
                </optgroup>
            </select>
            <select id="mode" onchange="resetGame()">
                <option value="ordered">In Order</option>
                <option value="random">Smart Random</option>
            </select>
        </div>

        <div class="card-container">
            <div class="card" id="letterDisplay">A</div>
        </div>

        <div class="actions">
            <button class="round-btn btn-wrong" onclick="handleAnswer(false)">‚úñ</button>
            <button class="round-btn btn-correct" onclick="handleAnswer(true)">‚úî</button>
        </div>
        
        <button onclick="openReport()" style="margin-top: 20px; background: none; border: none; color: #888; text-decoration: underline; cursor: pointer; padding: 10px;">View Progress Report</button>
    </div>

    <div class="modal-overlay" id="reportModal">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                <h2 style="margin:0; color: var(--secondary);">Progress Report</h2>
                <button onclick="goBack()" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            <div style="overflow-y: auto; flex-grow: 1;">
                <table id="reportTable">
                    <thead><tr><th>Letter</th><th>Correct</th><th>Needs Practice</th></tr></thead>
                    <tbody id="reportList"></tbody>
                </table>
            </div>
            <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                <button onclick="resetStats()" style="background: #eee; color: #555; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;">Reset History</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. WEB AUDIO API SOUND ENGINE ---
        // This generates sounds on the fly (no files needed!)
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        let isMuted = false;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playCorrectSound() {
            if (isMuted || !audioCtx) return;
            // A cheerful "Ding-Dong" (Two tones)
            playTone(600, 'sine', 0.1); 
            setTimeout(() => playTone(800, 'sine', 0.3), 100);
        }

        function playWrongSound() {
            if (isMuted || !audioCtx) return;
            // A gentle, hollow "Bonk" (Low sine wave, quick decay)
            playTone(150, 'sine', 0.15);
        }

        function playTone(freq, type, duration) {
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            // Fade out nicely to avoid clicking sounds
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function toggleMute() {
            isMuted = !isMuted;
            const btn = document.getElementById('muteBtn');
            if(isMuted) {
                btn.innerText = "üîá";
                btn.classList.add('muted');
            } else {
                btn.innerText = "üîä";
                btn.classList.remove('muted');
                initAudio(); // Ensure audio is ready on unmute
                playCorrectSound(); // Test sound
            }
        }

        // --- 2. NAVIGATION ---
        window.onhashchange = function() {
            const hash = window.location.hash;
            const splash = document.getElementById('splashScreen');
            const game = document.getElementById('gameContent');
            const modal = document.getElementById('reportModal');

            if (hash === '#game') {
                splash.classList.add('slide-up');
                game.style.display = 'flex';
                modal.style.display = 'none';
            } else if (hash === '#report') {
                modal.style.display = 'flex';
            } else {
                splash.classList.remove('slide-up');
                setTimeout(() => { if(!window.location.hash) game.style.display = 'none'; }, 400);
                modal.style.display = 'none';
            }
        };

        function goBack() { history.back(); }

        /* --- GAME DATA --- */
        const fullAlphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
        const letterSets = {
            'all': "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
            'set1': "ABCDE", 'set2': "FGHIJ", 'set3': "KLMNO", 'set4': "PQRST", 'set5': "UVWXYZ",
            'straight': "EFHILT", 'curves': "COQGS", 'diagonal': "KMNVWXYZ", 'combined': "BDJPRU"
        };
        let weights = new Array(26).fill(1);
        let correctCounts = new Array(26).fill(0);
        let wrongCounts = new Array(26).fill(0);
        let currentSetIndices = [];
        let currentIndexInSet = 0; 
        let currentLetter = 'A';
        let isProcessing = false;

        const display = document.getElementById('letterDisplay');
        const card = document.querySelector('.card');

        function startGame() {
            initAudio(); // Wake up audio context on user interaction
            window.location.hash = "game";
            updateActiveSet();
            updateDisplay();
        }

        function openReport() {
            window.location.hash = "report";
            const tbody = document.getElementById('reportList');
            tbody.innerHTML = '';
            let data = fullAlphabet.map((char, i) => ({
                char: char, c: correctCounts[i], w: wrongCounts[i]
            })).filter(d => (d.c + d.w) > 0);
            data.sort((a, b) => b.w - a.w);
            if(data.length === 0) {
                tbody.innerHTML = "<tr><td colspan='3' style='text-align:center; color:#888;'>No games played yet!</td></tr>";
            } else {
                data.forEach(item => {
                    let row = document.createElement('tr');
                    row.innerHTML = `<td style="font-size:20px;">${item.char}</td>
                                     <td style="color:var(--secondary)">${item.c}</td>
                                     <td style="color:var(--primary)">${item.w}</td>`;
                    tbody.appendChild(row);
                });
            }
        }

        function updateActiveSet() {
            const setKey = document.getElementById('letterSet').value;
            let setString = letterSets[setKey] || letterSets['all'];
            currentSetIndices = setString.split("").map(char => fullAlphabet.indexOf(char));
            currentIndexInSet = 0;
            let globalIndex = currentSetIndices[0];
            currentLetter = fullAlphabet[globalIndex];
        }

        function updateDisplay() {
            card.classList.remove('shake', 'pop');
            void card.offsetWidth; 
            display.innerText = currentLetter;
            isProcessing = false;
        }

        function handleAnswer(isCorrect) {
            if(isProcessing) return;
            isProcessing = true;
            const globalIndex = fullAlphabet.indexOf(currentLetter);
            if(isCorrect) {
                correctCounts[globalIndex]++;
                weights[globalIndex] = 1; 
                card.classList.add('pop');
                spawnConfetti();
                playCorrectSound(); // Sound!
            } else {
                wrongCounts[globalIndex]++;
                weights[globalIndex] += 5; 
                card.classList.add('shake');
                playWrongSound(); // Sound!
            }
            setTimeout(pickNextLetter, 800); 
        }

        function pickNextLetter() {
            const mode = document.getElementById('mode').value;
            if(mode === 'ordered') {
                currentIndexInSet++;
                if(currentIndexInSet >= currentSetIndices.length) currentIndexInSet = 0;
                let globalIndex = currentSetIndices[currentIndexInSet];
                currentLetter = fullAlphabet[globalIndex];
            } else {
                let activeWeights = currentSetIndices.map(i => weights[i]);
                let totalWeight = activeWeights.reduce((a, b) => a + b, 0);
                let random = Math.random() * totalWeight;
                let selectedIndex = currentSetIndices[0];
                for(let i=0; i<currentSetIndices.length; i++) {
                    let gIndex = currentSetIndices[i];
                    random -= weights[gIndex];
                    if(random <= 0) {
                        selectedIndex = gIndex;
                        break;
                    }
                }
                currentLetter = fullAlphabet[selectedIndex];
            }
            updateDisplay();
        }

        function changeSet() { updateActiveSet(); updateDisplay(); }
        function resetGame() { currentIndexInSet = 0; updateDisplay(); }

        function spawnConfetti() {
            const colors = ['#d32f2f', '#00a896', '#FFD500', '#FFFFFF', '#00E5FF'];
            const shapes = ['‚òÖ', '‚ú®', '‚óè', '‚≠ê', '‚ö°'];
            for(let i=0; i<20; i++) {
                let particle = document.createElement('div');
                particle.classList.add('confetti');
                particle.innerText = shapes[Math.floor(Math.random() * shapes.length)];
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.top = '-50px';
                particle.style.color = colors[Math.floor(Math.random() * colors.length)];
                particle.style.animationDuration = (Math.random() * 1.5 + 1) + 's'; 
                document.body.appendChild(particle);
                setTimeout(() => { particle.remove(); }, 2500);
            }
        }

        function resetStats() {
            if(confirm("Clear progress history?")) {
                weights.fill(1);
                correctCounts.fill(0);
                wrongCounts.fill(0);
                goBack(); 
            }
        }
    </script>
</body>
</html>